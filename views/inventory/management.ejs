<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%- title %> | UHWF-TANZANIA 2025</title>
  <link rel="stylesheet" href="/css/styles.css">
  <!-- js script -->
  <script src="/js/script.js" defer></script>
  <!-- Only Bootstrap Icons (no Bootstrap CSS/JS) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Optional: Font Awesome if you want extra icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="body">
  <div class="overlay" id="overlay"></div>
  <main class="body">
    <div class="dashboard">
      <!-- Header -->
      <header class="header">
        <div class="menu-toggle" id="menuToggle">
          <i class="bi bi-list" style="color: black;"></i>
        </div>
        <h3>Dashboard</h3>
        <div class="user">
          <div id="tools">
            <% if(locals.loggedin){ %>

              <% 
                const now = new Date();
                const hour = now.getHours();
                let greeting = "ðŸ‘‹ Hello";
                
                if (hour >= 5 && hour < 12) {
                  greeting = "ðŸŒ… Good morning";
                } else if (hour >= 12 && hour < 17) {
                  greeting = "â˜€ï¸ Good afternoon";
                } else if (hour >= 17 && hour < 22) {
                  greeting = "ðŸŒ† Good evening";
                } else {
                  greeting = "ðŸŒ™ Good night";
                }
              %>
      
              <a href="/account/" class="welcome-link">
                <%= greeting %>, <%= locals.accountData?.account_firstname || 'User' %>
              </a>
              <a href="/account/logout" class="logout-link"><button>Logout <i class="bi bi-box-arrow-right"></i></button></a>
            <%} else{%>
              <a title="Click to log in" href="/account/login">My Account</a>
            <%}%>
          </div>
        </div>
      </header>

      <!-- Sidebar -->
      <aside id="sidebar">
        <h2>UHWF PORTAL</h2>
        <ul>
          <li><i class="bi bi-border-all"></i> Dashboard</li>
          <!-- Member Dropdown -->
          <li class="dropdown-1">
            <span><i class="bi bi-person"></i> Member</span>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="javascript:openAddMemberModal()"><i class="bi bi-plus-circle"></i> Add Member</a></li>
              <li><a class="dropdown-item" href="javascript:openSearchMemberModal()"><i class="bi bi-pencil-square"></i> Edit Member</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-eye"></i> View Member</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-trash"></i> Delete Member</a></li>
            </ul>
          </li>
          <!-- Citizen Dropdown -->
          <li class="dropdown-1">
            <span><i class="bi bi-person"></i> Citizen</span>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#"><i class="bi bi-plus-circle"></i> Add Citizen</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-pencil-square"></i> Edit Citizen</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-eye"></i> View Citizen</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-trash"></i> Delete Citizen</a></li>
            </ul>
          </li>

          <!-- Employee Dropdown -->
          <li class="dropdown-1">
            <span><i class="bi bi-person"></i> Employee</span>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#"><i class="bi bi-plus-circle"></i> Add Employee</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-pencil-square"></i> Edit Employee</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-eye"></i> View Employee</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-trash"></i> Delete Employee</a></li>
            </ul>
          </li>

          <!-- Student Dropdown -->
          <li class="dropdown-1">
            <span><i class="bi bi-person"></i> Student</span>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#"><i class="bi bi-plus-circle"></i> Add Student</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-pencil-square"></i> Edit Student</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-eye"></i> View Student</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-trash"></i> Delete Student</a></li>
            </ul>
          </li>

          <li><i class="bi bi-file-earmark-richtext"></i> Reports</li>

          <!-- Settings Dropdown (Admin features) -->
          <li class="dropdown-1">
            <span><i class="bi bi-gear"></i> Settings</span>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#"><i class="bi bi-pencil-square"></i> Edit Profile</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-plus-circle"></i> Add Admin</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-pencil-square"></i> Edit Admin Details</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-trash"></i> Delete Admin</a></li>
            </ul>
          </li>
        </ul>
      </aside>

      <!-- Main Content -->
      <div class="main-body">
        <div class="cards">
          <div class="card"><h4>Students</h4><p><%= studentCount || 0 %></p></div>
          <div class="card"><h4>Members</h4><p><%= memberCount || 0 %></p></div>
          <div class="card"><h4>Payments</h4><p>TSH 0</p></div>
          <div class="card"><h4>Feedback</h4><p>0%</p></div>
          <div class="card"><h4>Growth</h4><p>0%</p></div>
          <div class="card"><h4>Active Users</h4><p><p><%= activeCount %></p></p></div>
        </div>

        <div class="dashboard-footer">
          <div class="version" style="margin-top: 1.9rem;"><p>Version: 1.0.0.0</p></div>
          <ul id="footer">
            <li><a href="">Home |</a></li>
            <li><a href="">About |</a></li>
            <li><a href="">Contact |</a></li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Pure JavaScript for mobile sidebar toggle
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');

    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    });

    overlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
    });
  </script>

  <!-- Success Popup Modal -->
<div id="successModal" class="modal-overlay">
  <div class="modal-content" style="max-width: 400px; text-align: center;">
    <span class="modal-close" onclick="closeSuccessModal()">&times;</span>
    <h3 style="color: #28a745;">Success!</h3>
    <p style="font-size: 18px;"><%= messages.notice %></p>
    <button onclick="closeSuccessModal()" style="padding:10px 20px; background:#28a745; color:white; border:none; border-radius:6px; margin-top:20px;">
      OK
    </button>
  </div>
</div>
  <%- include('add-member') %>
  <%- include('edit-member') %>
  <%- include('search-member') %>

<!-- Success Popup Modal -->
<div id="successModal" class="modal-overlay">
  <div class="modal-content" style="max-width: 400px; text-align: center;">
    <span class="modal-close" onclick="closeSuccessModal()">&times;</span>
    <h3 style="color: #28a745; margin: 20px 0;">Success!</h3>
    <p style="font-size: 18px; margin: 20px 0;">
      <%= messages.notice || 'Changes saved successfully!' %>
    </p>
    <button onclick="closeSuccessModal()" 
            style="padding: 12px 30px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer;">
      OK
    </button>
  </div>
</div>

<script>
  // Show popup if we came from update
  window.addEventListener('load', function() {
    if (window.location.search.includes('updated=true')) {
      document.getElementById('successModal').classList.add('active');
    }
  });

  function closeSuccessModal() {
    document.getElementById('successModal').classList.remove('active');
    // Optional: remove ?updated=true from URL
    history.replaceState(null, '', '/account/');
  }

  // Close when clicking outside
  document.getElementById('successModal').addEventListener('click', function(e) {
    if (e.target === this) closeSuccessModal();
  });
</script>

<style>
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal-overlay.active {
    display: flex;
  }
  .modal-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  .modal-overlay p{
    color: black;
  }
</style>
</style>

</body>
</html>